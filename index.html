<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ¥½ãƒœãƒ¼ãƒˆ</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  padding:20px;
}
h1{text-align:center;color:white;}
.card{
  background:white;
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
}
label{font-weight:bold;margin-top:10px;display:block;}
input{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid #ddd;
}
button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:10px;
  background:#2a5298;
  color:white;
  font-weight:bold;
}
.result{font-size:18px;font-weight:bold;margin-top:10px;}
.plus{color:#00b894;}
.minus{color:#d63031;}
.list-item{font-size:14px;margin-top:5px;}
#message{margin-top:10px;font-weight:bold;text-align:center;}
canvas{margin-top:20px;}
</style>
</head>

<body>

<h1>æ¥½ãƒœãƒ¼ãƒˆ</h1>

<div class="card">
<label>æ—¥ä»˜</label>
<input type="date" id="date">

<label>å ´æ‰€ãƒ»ãƒ¬ãƒ¼ã‚¹å</label>
<input type="text" id="place">

<label>æŠ•è³‡é‡‘é¡</label>
<input type="number" id="bet">

<label>æ‰•æˆ»é‡‘é¡</label>
<input type="number" id="pay">

<div class="result">
ã“ã®ãƒ¬ãƒ¼ã‚¹ã®åæ”¯ï¼š
<span id="raceProfit">Â¥0</span>
</div>

<button onclick="saveRecord()">ä¿å­˜ã™ã‚‹</button>

<hr>

<div class="result">
ä»Šæ—¥ã®åæ”¯ï¼š
<span id="todayProfit">Â¥0</span>
</div>

<div class="result">
ä»Šæ—¥ã®å›åç‡ï¼š
<span id="todayRate">0%</span>
</div>

<div id="todayList"></div>

<hr>

<div class="result">
ä»Šæœˆãƒˆãƒ¼ã‚¿ãƒ«ï¼š
<span id="monthProfit">Â¥0</span>
</div>

<div class="result">
ä»Šæœˆå›åç‡ï¼š
<span id="monthRate">0%</span>
</div>

<div id="message"></div>

<canvas id="chart"></canvas>

</div>

<script>
let records = JSON.parse(localStorage.getItem("records"))||[];

function formatYen(num){
  return "Â¥"+num.toLocaleString();
}

function calcRace(){
  const bet=Number(betEl.value||0);
  const pay=Number(payEl.value||0);
  const p=pay-bet;
  raceProfit.innerText=(p>=0?"+":"")+formatYen(p);
}
const betEl=document.getElementById("bet");
const payEl=document.getElementById("pay");
const raceProfit=document.getElementById("raceProfit");
betEl.addEventListener("input",calcRace);
payEl.addEventListener("input",calcRace);

function saveRecord(){
  const bet=Number(betEl.value);
  const pay=Number(payEl.value);
  const date=document.getElementById("date").value;
  const place=document.getElementById("place").value;

  if(!date||!bet)return alert("æ—¥ä»˜ã¨æŠ•è³‡é‡‘é¡å…¥åŠ›");

  records.push({bet,pay,date,place});
  localStorage.setItem("records",JSON.stringify(records));

  updateAll();
  alert("ä¿å­˜ã—ã¾ã—ãŸ");
}

function updateAll(){
  const today=new Date().toISOString().slice(0,10);
  const month=today.slice(0,7);

  let tBet=0,tPay=0,mBet=0,mPay=0;

  const todayList=document.getElementById("todayList");
  todayList.innerHTML="";

  records.forEach(r=>{
    if(r.date===today){
      tBet+=r.bet;
      tPay+=r.pay;

      const p=r.pay-r.bet;
      const div=document.createElement("div");
      div.className="list-item";
      div.innerText=`${r.place} æŠ•è³‡${formatYen(r.bet)} æ‰•æˆ»${formatYen(r.pay)} ${(p>=0?"+":"")+formatYen(p)}`;
      todayList.appendChild(div);
    }
    if(r.date.startsWith(month)){
      mBet+=r.bet;
      mPay+=r.pay;
    }
  });

  const tProfit=tPay-tBet;
  const tRate=tBet?((tPay/tBet)*100).toFixed(1):0;
  const mProfit=mPay-mBet;
  const mRate=mBet?((mPay/mBet)*100).toFixed(1):0;

  setValue("todayProfit",tProfit);
  setValue("monthProfit",mProfit);

  todayRate.innerText=tRate+"%";
  monthRate.innerText=mRate+"%";

  message.innerText=tProfit<0?
  "ä»Šæ—¥ã¯ã“ã“ã¾ã§ã«ã—ã‚ˆã€‚æ·±è¿½ã„æ³¨æ„âš ï¸":
  "ã„ã„æ„Ÿã˜ã€‚ã§ã‚‚ç„¡ç†ã—ã™ããªã„ã§ğŸ‘";

  drawChart();
}

function setValue(id,val){
  const el=document.getElementById(id);
  el.innerText=(val>=0?"+":"")+formatYen(val);
  el.className=val>=0?"plus":"minus";
}

function drawChart(){
  const ctx=document.getElementById("chart");
  const daily={};
  records.forEach(r=>{
    if(!daily[r.date])daily[r.date]=0;
    daily[r.date]+=r.pay-r.bet;
  });

  const dates=Object.keys(daily).sort();
  let sum=0;
  const data=dates.map(d=>{
    sum+=daily[d];
    return sum;
  });

  new Chart(ctx,{
    type:"line",
    data:{
      labels:dates,
      datasets:[{
        label:"ç´¯è¨ˆåæ”¯",
        data:data,
        fill:false,
        tension:0.2
      }]
    }
  });
}

updateAll();
</script>

</body>
</html>
